[supervisord]
nodaemon=false
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[inet_http_server]
port = 127.0.0.1:9001

[supervisorctl]
serverurl=http://127.0.0.1:9001

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:xvfb]
command=/usr/bin/Xvfb :99 -screen 0 1920x1080x24
autostart=true
autorestart=true
startsecs=5
stopasgroup=true
stdout_logfile=/var/log/supervisor/xvfb.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/xvfb_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

[program:fluxbox]
command=/usr/bin/fluxbox
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
environment=DISPLAY=:99
stdout_logfile=/var/log/supervisor/fluxbox.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/fluxbox_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
depends_on=xvfb

[program:x11vnc]
command=/usr/bin/x11vnc -display :99 -listen localhost -nopw -xkb -shared -repeat -rfbport 5900
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
stdout_logfile=/var/log/supervisor/x11vnc.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/x11vnc_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
depends_on=xvfb,fluxbox

[program:novnc]
command=/opt/noVNC/utils/novnc_proxy --vnc localhost:5900 --listen 6080
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
stdout_logfile=/var/log/supervisor/novnc.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/novnc_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
depends_on=x11vnc

[program:ttyd]
command=/usr/local/bin/ttyd -p 7681 /bin/bash --login
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
user=claude
environment=HOME=/home/claude,USER=claude
stdout_logfile=/var/log/supervisor/ttyd.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/ttyd_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

[program:file-api]
command=/usr/local/bin/node /app/backend/server.js
directory=/app/backend
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
environment=NODE_ENV=production,PORT=8080
stdout_logfile=/var/log/supervisor/file-api.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/file-api_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

[program:nginx]
command=/usr/sbin/nginx -g 'daemon off;'
autostart=true
autorestart=true
startsecs=3
stopasgroup=true
stdout_logfile=/var/log/supervisor/nginx.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/nginx_err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

[group:display-server]
programs=xvfb,fluxbox,x11vnc,novnc
priority=10

[group:web-services]
programs=nginx,file-api
priority=20

[group:terminal-service]
programs=ttyd
priority=15
